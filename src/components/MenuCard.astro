---
/**
 * MenuCard Component (Astro Version)
 * Redesigned to match the Kabasaran Heritage aesthetic.
 * Features a sharp, artisanal design with vibrant red accents and refined typography.
 */
interface Props {
  name: string;
  desc: string;
  price: string;
  imageUrl?: string;
}

const { name, desc, price, imageUrl } = Astro.props;

const kabasaranRed = "#C51D1D";
const charcoal = "#1C1917";
---

<div class="menu-card relative bg-white overflow-hidden flex flex-col h-full border border-[#1C1917]/5 shadow-sm">
  
  <!-- Information Content -->
  <div class="p-8 flex flex-col grow relative bg-white">
    <!-- Warrior Accent - Static red line -->
    <div 
      class="h-[2px] mb-6 w-8"
      style={`background-color: ${kabasaranRed};`}
    ></div>
    
    <div class="mb-4">
      <h4 
        class="serif-display text-3xl font-bold leading-none italic"
        style={`color: ${charcoal};`}
      >
        {name}
      </h4>
    </div>
    
    <!-- Updated description style: matches the main page's stone-500 color and leading-relaxed spacing -->
    <div class="mb-12 relative group">
      <p class="description-text text-sm text-stone-500 leading-relaxed line-clamp-3 transition-all duration-300">
        {desc}
      </p>
      <button 
        class="read-more-btn hidden text-[10px] font-bold uppercase tracking-widest mt-3 hover:opacity-70 transition-opacity focus:outline-none"
        style={`color: ${kabasaranRed};`}
      >
        Read more
      </button>
    </div>
    
    <!-- Card Footer -->
    <div class="mt-auto flex items-center justify-end gap-x-8 gap-y-3">
      <!-- Price Badge - Fixed to the bottom right of the card -->
      <div 
        class="text-white px-4 py-2 font-black text-sm tracking-[0.2em] shadow-md z-20"
        style={`background-color: ${kabasaranRed};`}
      >
        ${price}
      </div>
    </div>
  </div>
</div>

<style>
  .menu-card {
    border-radius: 2px;
  }

  .serif-display {
    font-family: 'Unna', serif;
  }
</style>

<script>
  function initReadMore() {
    const cards = document.querySelectorAll('.menu-card');
    
    cards.forEach(card => {
      const desc = card.querySelector('.description-text');
      const btn = card.querySelector('.read-more-btn');
      
      if (!desc || !btn) return;

      // Check if text is truncated
      const checkOverflow = () => {
        // We compare scrollHeight to clientHeight
        // If scrollHeight is larger, it means text is clamped/overflowing
        if (desc.scrollHeight > desc.clientHeight) {
          btn.classList.remove('hidden');
        }
      };

      // Initial check
      checkOverflow();
      
      // Re-check on window resize (optional, but good for responsive)
      window.addEventListener('resize', checkOverflow);

      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const isClamped = desc.classList.contains('line-clamp-3');
        
        if (isClamped) {
          desc.classList.remove('line-clamp-3');
          btn.textContent = 'Read Less';
        } else {
          desc.classList.add('line-clamp-3');
          btn.textContent = 'Read More';
        }
      });
    });
  }

  // Run on DOM content loaded and when Astro swaps pages (if using view transitions, though not present here, good practice)
  document.addEventListener('DOMContentLoaded', initReadMore);
</script>
